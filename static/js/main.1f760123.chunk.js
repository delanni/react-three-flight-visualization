(this["webpackJsonpreact-three-js"]=this["webpackJsonpreact-three-js"]||[]).push([[0],{42:function(e,t,r){},46:function(e,t,r){},51:function(e,t,r){"use strict";r.r(t);r(42);var n=r(8),i=r.n(n),c=r(23),a=r.n(c),o=r(11),s=(r(46),r(13)),l=r(56),j=r(9),u=r(55),d=r(1),b=new d.Vector3(-1,0,0),h=new d.Vector3(0,1,0),O=(new d.Vector3(1,0,0),.05),m=[0,3.14,2.77],f=[10.3,-24.2,6.4],p=r(5),g="/react-three-flight-visualization/models/globe/globe.gltf",x=42;function v(e){var t=Object.assign({},e),r=Object(n.useRef)(),i=Object(u.a)(g),c=i.nodes,a=i.materials;return Object(p.jsx)("group",Object(j.a)(Object(j.a)({scale:O,ref:r},t),{},{dispose:null,children:Object(p.jsx)("mesh",{name:"Earth_Surfacemat_0",geometry:c.Earth_Surfacemat_0.geometry,material:a["Surface.mat"],userData:{name:"Earth_Surface.mat_0"}})}))}u.a.preload(g);var S="/react-three-flight-visualization/models/plane/plane.gltf",M=new d.MeshStandardMaterial({emissive:"hotpink",emissiveIntensity:2});function y(e){var t=Object.assign({},e),r=Object(n.useRef)(),i=Object(u.a)(S),c=i.nodes,a=i.materials;return Object(p.jsx)("group",Object(j.a)(Object(j.a)({scale:.0033333333333333335,ref:r},t),{},{dispose:null,children:Object(p.jsxs)("group",{position:f,rotation:m,name:"tinkerobjcleanermaterialmergergles",userData:{name:"tinker.obj.cleaner.materialmerger.gles"},children:[Object(p.jsx)("mesh",{name:"mesh_0",geometry:c.mesh_0.geometry,material:t.selected?M:a.color_10988977}),Object(p.jsx)("mesh",{name:"mesh_1",geometry:c.mesh_1.geometry,material:a.color_15277357}),Object(p.jsx)("mesh",{name:"mesh_2",geometry:c.mesh_2.geometry,material:a.color_16448250}),Object(p.jsx)("mesh",{name:"mesh_3",geometry:c.mesh_3.geometry,material:a.color_2829873})]})}))}u.a.preload(S);var k=r(52),w=r(36);function C(e){var t,r,n;return Object(p.jsxs)("mesh",Object(j.a)(Object(j.a)({},e),{},{scale:1,children:[Object(p.jsx)("boxGeometry",{args:[(null===(t=e.size)||void 0===t?void 0:t[0])||1,(null===(r=e.size)||void 0===r?void 0:r[1])||1,(null===(n=e.size)||void 0===n?void 0:n[2])||1]}),Object(p.jsx)("meshStandardMaterial",{opacity:1,color:e.color})]}))}function F(e,t){var r=(new d.Quaternion).setFromAxisAngle(b,Object(w.a)(e-90));return(new d.Quaternion).setFromAxisAngle(h,Object(w.a)(t)).multiply(r)}var T=function(e){return e.toString().padStart(2,"0")},_=Object(k.a)((function(e){return e.toISOString()}),(function(e){var t=T(e.getMonth()+1),r=T(e.getDate()),n=T(e.getHours()),i=T(e.getMinutes());return"".concat(t,"/").concat(r," ").concat(n,":").concat(i)})),I=function(e){return Math.floor(e/6e4)};function A(e){return Object(j.a)(Object(j.a)({},e),{},{departureTime:new Date(e.departureTime),arrivalTime:new Date(e.arrivalTime)})}var P=Object(k.a)((function(e,t){return"".concat(e.latitude,",").concat(e.longitude,";").concat(t.latitude,",").concat(t.longitude)}),(function(e,t){var r=Math.sign(t.latitude-e.latitude),n=Math.sign(t.longitude-e.longitude),i="".concat(r,";").concat(n),c=Math.PI,a={"1;1":c+Math.PI,"-1;1":c,"-1;-1":c,"1;-1":c+Math.PI}[i]||c;return Math.abs(t.latitude-e.latitude)<1&&(a+=Math.PI/2),a}));function N(e){var t=e.from,r=e.to,i=e.flight,c=e.selected,a=e.onFlightClicked,o=Object(n.useRef)(),l=Object(n.useRef)();return Object(s.b)((function(e,n){var c=e.clock.hackedWorldTime,a=F(t.latitude,t.longitude),s=F(r.latitude,r.longitude);if(o.current&&l.current){var j=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=t-e,c=r-e;return n?Math.min(1,Math.max(0,c/i)):c/i}(Number(i.departureTime),Number(i.arrivalTime),c),u=l.current.getWorldPosition(new d.Vector3),b=new d.Quaternion;b.slerpQuaternions(a,s,j),o.current.setRotationFromQuaternion(b),l.current.lookAt(u),l.current.rotation.z=P(t,r)}})),Object(p.jsx)("group",{ref:o,children:Object(p.jsx)("group",{ref:l,"position-y":x*O+.05,children:Object(p.jsx)(y,{selected:c,onClick:function(e){return a(i,e)}})})})}var D=864e5;function L(){var e=Object(n.useRef)();return Object(s.b)((function(t,r){var n=t.clock.hackedWorldTime%D/D,i=2*Math.PI*n+Math.PI;if(e.current){var c=10*Math.sin(i),a=10*Math.cos(i);e.current.position.set(c,0,a)}})),Object(p.jsxs)("group",{ref:e,position:[0,0,10],children:[Object(p.jsx)(E,{baseColor:"yellow",position:[1,0,1]}),Object(p.jsx)("pointLight",{intensity:5})]})}function E(e){return Object(p.jsxs)("mesh",Object(j.a)(Object(j.a)({},e),{},{ref:e.reference,children:[Object(p.jsx)("sphereGeometry",{args:[.1]}),Object(p.jsx)("meshStandardMaterial",{color:e.baseColor})]}))}var R=r(53),z=x*O,Q=[0,z+.04,0],V=[0,z,0];function W(e){var t=Object(n.useRef)(),r=Object(n.useRef)(),i=Object(n.useState)(!1),c=Object(o.a)(i,2),a=c[0],l=c[1],j=Object(n.useState)(Math.random()),u=Object(o.a)(j,1)[0],d=F(e.airport.latitude,e.airport.longitude);return Object(s.b)((function(e,t){if(r.current){var n=3+u,i=e.clock.elapsedTime%n/n;r.current.intensity=a?3:.5*Math.sin(i*Math.PI*2)+.5}})),Object(p.jsxs)("group",{ref:t,quaternion:d,children:[a?Object(p.jsx)(R.a,{"position-y":z,children:Object(p.jsxs)("div",{className:"info-bubble",onPointerOver:function(){return l(!0)},onPointerOut:function(){return l(!1)},children:[Object(p.jsxs)("div",{children:["[",e.airport.city,"]"]}),Object(p.jsxs)("div",{children:[e.airport.id," "]}),Object(p.jsxs)("div",{children:["(",e.airport.latitude,";",e.airport.longitude,")"]}),Object(p.jsx)("a",{target:"_blank",href:"https://en.wikipedia.org/wiki/".concat(e.airport.city),children:"wikipedia"})]})}):null,Object(p.jsx)(C,{onPointerOver:function(){return l(!0)},onPointerOut:function(){return l(!1)},size:[.05,.05,.05],color:a?"limegreen":"red",position:V}),Object(p.jsx)(G,{position:Q,baseColor:a?"limegreen":"red"}),Object(p.jsx)("pointLight",{ref:r,color:a?"limegreen":"red",position:Q})]})}function G(e){return Object(p.jsxs)("mesh",Object(j.a)(Object(j.a)({},e),{},{ref:e.reference,children:[Object(p.jsx)("sphereGeometry",{args:[.01]}),Object(p.jsx)("meshStandardMaterial",{color:e.baseColor})]}))}function J(e){var t=e.flightsList,r=e.airportsMap,n=e.airportsList,i=e.setSelectedFlight,c=e.selectedFlight,a=e.simulationSpeed,o=e.onSimulationMinuteTick;return Object(s.b)((function(e,t){var r=e.clock,n=r.hackedWorldTime||Date.now(),i=n+Math.floor(1e3*t*a);r.hackedWorldTime=i,I(n)!==I(i)&&o(i)})),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(l.a,{}),Object(p.jsx)(L,{}),Object(p.jsx)(v,{}),t.map((function(e){var t=r[e.departureAirportId],n=r[e.arrivalAirportId],a=(null===c||void 0===c?void 0:c.id)===e.id;return Object(p.jsx)(N,{flight:e,from:t,to:n,selected:a,onFlightClicked:function(){return i(e)}},e.id)})),n.map((function(e){return Object(p.jsx)(W,{airport:e},e.id)}))]})}var q=r(54);function B(e){var t=e.flights,r=e.airports,i=e.airportMap,c=e.onFilteringChanged,a=e.simulationTime,s=e.maxFlightCount,l=e.selectedFlight,j=e.setSelectedFlight,u=Object(n.useState)(""),d=Object(o.a)(u,2),b=d[0],h=d[1],O=Object(n.useState)(""),m=Object(o.a)(O,2),f=m[0],g=m[1],x=Object(n.useState)(""),v=Object(o.a)(x,2),S=v[0],M=v[1],y=Object(n.useState)(!0),k=Object(o.a)(y,2),w=k[0],C=k[1],F=Object(n.useState)(t),T=Object(o.a)(F,2),I=T[0],A=T[1];return Object(n.useEffect)((function(){var e=t.filter((function(e){return e.departureAirportId.includes(b)&&e.arrivalAirportId.includes(f)&&e.id.includes(S)&&(!w||function(e,t){var r=Number(e.departureTime),n=Number(e.arrivalTime);return r<t&&t<n}(e,a))})).slice(0,s);A(e),c(e)}),[b,f,S,w,t,c,a,s]),Object(p.jsx)("div",{className:"flightFilterControls",children:Object(p.jsxs)("table",{children:[Object(p.jsx)("thead",{className:"flight-row-header",children:Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:"Flight"}),Object(p.jsx)("td",{children:"Departure time"}),Object(p.jsx)("td",{children:"Departure airport"}),Object(p.jsx)("td",{children:"Destination airport"}),Object(p.jsx)("td",{children:"Expected arrival"}),Object(p.jsx)("td",{children:"Visible"})]})}),Object(p.jsx)("thead",{children:Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:Object(p.jsx)("input",{type:"text",value:S,onChange:function(e){return M(e.target.value)}})}),Object(p.jsxs)("td",{children:[Object(p.jsx)("span",{children:"Is currently flying:"}),Object(p.jsx)("input",{type:"checkbox",checked:w,onChange:function(e){return C(e.target.checked)}})]}),Object(p.jsx)("td",{children:Object(p.jsxs)("select",{onChange:function(e){return h(e.target.value)},children:[Object(p.jsx)("option",{value:"",children:"ALL"}),r.map((function(e){var t=e.id,r=e.city;return Object(p.jsxs)("option",{value:t,children:["[",t,"]",r]},t)}))]})}),Object(p.jsx)("td",{children:Object(p.jsxs)("select",{onChange:function(e){return g(e.target.value)},children:[Object(p.jsx)("option",{value:"",children:"ALL"}),r.map((function(e){var t=e.id,r=e.city;return Object(p.jsxs)("option",{value:t,children:["[",t,"]",r]},t)}))]})}),Object(p.jsx)("td",{children:"Expected arrival"})]})}),Object(p.jsx)("tbody",{children:I.map((function(e,t){var r=["flight-row",t%2?"flight-row-even":"flight-row-odd",e.id===(null===l||void 0===l?void 0:l.id)?"flight-row-selected":""].join(" ");return Object(p.jsxs)("tr",{className:r,onClick:function(){return j(e)},children:[Object(p.jsx)("td",{children:e.id}),Object(p.jsx)("td",{children:_(e.departureTime)}),Object(p.jsx)("td",{children:i[e.departureAirportId].city}),Object(p.jsx)("td",{children:i[e.arrivalAirportId].city}),Object(p.jsx)("td",{children:_(e.arrivalTime)}),Object(p.jsx)("td",{children:t<s?"Yes\u2705":"No\u274c"})]},e.id)}))})]})})}function H(e){var t=e.onSimulationSpeedChange,r=Object(n.useState)(1),i=Object(o.a)(r,2),c=i[0],a=i[1];return Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{children:["Speed: ",c,"x | (1 minute = 10^",c," (=",Math.pow(10,c),") simulation minutes)"]}),Object(p.jsx)("input",{type:"range",min:0,max:4,step:1,value:c,onChange:function(e){var r=e.target.value;a(r),t(Math.pow(10,r))}})]})}function Y(e){var t=e.onMaxFlightCountChange,r=Object(n.useState)(10),i=Object(o.a)(r,2),c=i[0],a=i[1];return Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{children:["Max rendered flights: ",c]}),Object(p.jsx)("input",{type:"range",min:1,max:500,step:1,value:c,onChange:function(e){var r=e.target.value;a(r),t(r)}})]})}var K=Date.now();var U=function(){var e=Object(n.useState)([]),t=Object(o.a)(e,2),r=t[0],c=t[1],a=Object(n.useState)({}),l=Object(o.a)(a,2),j=l[0],u=l[1],d=Object(n.useState)([]),b=Object(o.a)(d,2),h=b[0],O=b[1];Object(n.useEffect)((function(){fetch("/react-three-flight-visualization/data/airports.json",{}).then((function(e){return e.json()})).then((function(e){var t=Object(q.a)((function(e){return e.id}),e);u(t),O(e)}))}),[]),Object(n.useEffect)((function(){fetch("/react-three-flight-visualization/data/flights.json",{}).then((function(e){return e.json()})).then((function(e){return e.map(A)})).then((function(e){return c(e)}))}),[]);var m=Object(n.useState)(null),f=Object(o.a)(m,2),g=f[0],x=f[1],v=Object(n.useState)([]),S=Object(o.a)(v,2),M=S[0],y=S[1],k=Object(n.useState)(20),w=Object(o.a)(k,2),C=w[0],F=w[1],T=Object(n.useState)(1),I=Object(o.a)(T,2),P=I[0],N=I[1],D=Object(n.useState)(K),L=Object(o.a)(D,2),E=L[0],R=L[1];return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsxs)("aside",{className:"controlPanel",children:[Object(p.jsxs)("div",{className:"input-controls",children:[Object(p.jsxs)("div",{children:["Current date: ",_(new Date(E))]}),Object(p.jsx)(Y,{onMaxFlightCountChange:F}),Object(p.jsx)(H,{onSimulationSpeedChange:N})]}),Object(p.jsx)("hr",{}),Object(p.jsx)(B,{flights:r,airports:h,airportMap:j,maxFlightCount:C,simulationTime:E,selectedFlight:g,setSelectedFlight:x,onFilteringChanged:y})]}),Object(p.jsx)(i.a.Suspense,{fallback:Object(p.jsx)("div",{children:"Loading data...\xf0"}),children:Object(p.jsx)(s.a,{id:"canvas",children:Object(p.jsx)(J,{flightsList:M,airportsList:h,airportsMap:j,selectedFlight:g,setSelectedFlight:x,simulationSpeed:P,onSimulationMinuteTick:R})})})]})};a.a.render(Object(p.jsx)(i.a.StrictMode,{children:Object(p.jsx)(U,{})}),document.getElementById("root"))}},[[51,1,2]]]);
//# sourceMappingURL=main.1f760123.chunk.js.map